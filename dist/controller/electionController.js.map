{"version":3,"sources":["../../server/controller/electionController.js"],"names":["electionDetailsModel","require","userElectionModel","usersModel","mongoose","jwt","env","electionController","getElection","req","res","next","company_name","body","query","$and","isActive","find","exec","err","result","json","isError","data","length","success","updateElection","token1","authorization","election_name","newelection_name","decoded","verify","App_key","console","log","role","update","election_date","$set","options","new","findOneAndUpdate","getAllApproveCandidateOld","department_name","findElectionQuery","findQuery","isApprove","resultObj","candidateData","userElection","searchQuery","Types","ObjectId","id","support","_id","supportArray","forEach","element","item","candidate","resultItem","full_name","phone_no","imageUrl","status","isSupport","push","getAllApproveCandidate","resultObjNew","count","sort","getAllApproveCandidateNew","aggregate","$group","userElectionData","$push","tryAggregration","$nor","$exists","approveCandidateData","module","exports"],"mappings":"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","file":"electionController.js","sourcesContent":["\r\nvar electionDetailsModel=require('../models/electionDetailsModel');\r\nvar userElectionModel=require('../models/userElectionModel');\r\nvar usersModel =require( '../models/usersModel')\r\nvar mongoose = require('mongoose');\r\n\r\nvar jwt =require( 'jsonwebtoken');\r\nvar env =require( \"../env\");\r\n\r\n\r\n\r\nconst electionController = {\r\n  getElection:(req,res,next)=>{\r\n    var company_name=req.body.company_name\r\n    var query=  {\r\n      $and:[\r\n        {company_name:company_name},\r\n        {isActive:true}\r\n      ]\r\n     }\r\n    electionDetailsModel.find( query).exec(function(err, result) { \r\n      if (err) {\r\n        res.json({\r\n          isError:true,\r\n          data:err\r\n        })\r\n      } else {\r\n        if (result.length) {\r\n          res.json({\r\n            success:true,\r\n            data:result[0]\r\n          })\r\n          \r\n        } else {\r\n          res.json({\r\n            success:true,\r\n            data:\"Yet Election is not added.\"\r\n          })\r\n        }\r\n       \r\n      }\r\n     });\r\n   \r\n  },\r\n  updateElection:(req,res,next)=>{\r\n    var token1=  req.body.authorization;\r\n    var company_name=req.body.company_name\r\n    var election_name=req.body.election_name\r\n    var newelection_name=req.body.newelection_name\r\n    var decoded = jwt.verify(token1, env.App_key);\r\n    console.log(\"decoded reqest from==>\", decoded.role)\r\n\r\n    if (decoded.role=='admin') {\r\n\r\n    var update={}\r\n    var query={\r\n      company_name:company_name,\r\n      election_name:election_name\r\n    }\r\n     if(newelection_name&&req.body.election_date ) {\r\n      update={\r\n        $set:{\r\n          election_name: newelection_name,\r\n          election_date:req.body.election_date\r\n        }\r\n      }\r\n    }\r\n    else if (newelection_name) {\r\n      update={\r\n        $set:{\r\n          election_name: newelection_name\r\n        }\r\n      }\r\n      \r\n    } else if(req.body.election_date ) {\r\n      update={\r\n        $set:{\r\n  \r\n          election_date:req.body.election_date\r\n        }\r\n      }\r\n    }\r\n \r\n    else{\r\n      update={}\r\n    }\r\n    options = {new: true};\r\n\r\n      electionDetailsModel.findOneAndUpdate(query,update,options,function(err, result) { \r\n        if (err) {\r\n          res.json({\r\n            isError:true,\r\n            data:err\r\n          })\r\n        } else {\r\n          res.json({\r\n            success:true,\r\n            data:result\r\n          })\r\n        }\r\n       });\r\n    }\r\n    else{\r\n\r\n    }\r\n\r\n  },\r\n  getAllApproveCandidateOld:(req,res,next)=>{\r\n    let company_name=req.body.company_name\r\n    let department_name=req.body.department_name\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    var findElectionQuery={\r\n     $and:[\r\n       {company_name:company_name},\r\n       {isActive:true},\r\n     ]\r\n   }\r\n \r\n    electionDetailsModel.find(findElectionQuery,function (err,result) {\r\n     if (err) {\r\n       res.json({\r\n         isError: true,\r\n         data: err\r\n       })\r\n       \r\n     } else {\r\n       if (result.length>0) {\r\n         var election_name=result[0].election_name\r\n         console.log(\"Election name==>\",election_name);\r\n         var findQuery={\r\n           $and:[\r\n             {company_name:company_name},\r\n             {department_name:department_name},\r\n             {election_name:election_name},\r\n             {isApprove:true}\r\n           ]\r\n         }\r\n  \r\n           var resultObj=[]\r\n           var candidateData=[];\r\n           var data={}\r\n           candidateData=result[0].candidateData;    \r\n       userElectionModel.find(findQuery,\r\n         function (err,userElection) {\r\n           if (err) {\r\n             res.json({\r\n               isError: true,\r\n               data: err\r\n             })\r\n             \r\n           } else \r\n           {\r\n             var searchQuery = {\r\n               $and: [\r\n                 { '_id':  mongoose.Types.ObjectId(decoded.id) },\r\n                 { 'company_name': company_name },\r\n               ]\r\n             };\r\n             usersModel.find(searchQuery,{support:1,_id:0}\r\n        \r\n             ,function(err, result) {\r\n               if (err) {\r\n                 res.json({\r\n                   isError: true,\r\n                   data: err\r\n                  })\r\n               } else {\r\n \r\n                 if (result.length>0) {\r\n                   let supportArray=result[0].support;\r\n                   userElection.forEach(element => {\r\n                     candidateData.forEach(item=>{\r\n                      if (item.candidate==element._id) {\r\n                       supportArray.forEach(resultItem=>{\r\n                         if (resultItem.candidate==item.candidate) {\r\n                           console.log(\"Element Matched==>\",resultItem.candidate);\r\n                           data={\r\n                             _id:element._id,\r\n                             full_name:element.full_name,\r\n                             phone_no:element.phone_no,\r\n                             imageUrl:element.imageUrl,\r\n                             status:element.status,\r\n                             support:item.support,\r\n                             department_name:element.department_name,\r\n                             company_name:element.company_name,\r\n                             isSupport:true\r\n                           }\r\n                         } else {\r\n                           console.log(\"Element Not Matched==>\",resultItem);\r\n                           data={\r\n                             _id:element._id,\r\n                             full_name:element.full_name,\r\n                             phone_no:element.phone_no,\r\n                             imageUrl:element.imageUrl,\r\n                             status:element.status,\r\n                             support:item.support,\r\n                             department_name:element.department_name,\r\n                             company_name:element.company_name,\r\n                             isSupport:false\r\n                           }\r\n                         }\r\n                       })\r\n \r\n                        resultObj.push(data)\r\n                        console.log(\"resultObj with support array==>\",resultObj);\r\n \r\n                      }\r\n                    })\r\n                  });\r\n                  if (resultObj.length==userElection.length) {\r\n                    console.log(\"resultObj==>\",resultObj);\r\n                    res.json({\r\n                      success: true,\r\n                      data: {resultObj}\r\n                    })\r\n                  }\r\n                   \r\n                 } else {\r\n                   userElection.forEach(element => {\r\n                     candidateData.forEach(item=>{\r\n                      if (item.candidate==element._id) {\r\n                         data={\r\n                          _id:element._id,\r\n                          full_name:element.full_name,\r\n                          phone_no:element.phone_no,\r\n                          imageUrl:element.imageUrl,\r\n                          status:element.status,\r\n                          support:item.support,\r\n                          department_name:element.department_name,\r\n                          company_name:element.company_name,\r\n                          isSupport:false\r\n                        }\r\n                        resultObj.push(data)\r\n                        console.log(\"resultObj withOut support array==>\",resultObj);\r\n \r\n                      }\r\n                    })\r\n                  });\r\n                  if (resultObj.length==userElection.length) {\r\n                    console.log(\"resultObj==>\",resultObj);\r\n                    res.json({\r\n                      success: true,\r\n                      data: {resultObj}\r\n                    })\r\n                  }\r\n                 }\r\n               \r\n               }\r\n             })\r\n          \r\n           }\r\n           \r\n         })\r\n          \r\n       } else {\r\n         \r\n         res.json({\r\n           isError:true,\r\n           data:'No data found'\r\n         })\r\n       }\r\n     \r\n     \r\n     }\r\n     \r\n   })\r\n   \r\n   },\r\n  getAllApproveCandidate:(req,res,next)=>{\r\n   let company_name=req.body.company_name\r\n  //  let department_name=req.body.department_name\r\n   var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n   console.log(\"getAllApproveCandidate->\",req.body);\r\n   \r\n   var findElectionQuery={\r\n    $and:[\r\n      {company_name:company_name},\r\n      {isActive:true},\r\n    ]\r\n  }\r\n\r\n   electionDetailsModel.find(findElectionQuery,function (err,result) {\r\n    if (err) {\r\n      res.json({\r\n        isError: true,\r\n        data: err\r\n      })\r\n      \r\n    } else {\r\n      // console.log(\"electionDetailsModel->\",result);\r\n      if (result.length>0) {\r\n        var election_name=result[0].election_name\r\n        // console.log(\"Election name==>\",election_name);\r\n      \r\n        var findQuery={\r\n          $and:[\r\n            {company_name:company_name},\r\n            {election_name:election_name},\r\n            {isApprove:true}\r\n          ]\r\n        }\r\n          var resultObj=[]\r\n          var resultObjNew=[];\r\n          var candidateData=[];\r\n          var data={}\r\n          candidateData=result[0].candidateData;    \r\n         userElectionModel.find(findQuery,\r\n        function (err,userElection) {\r\n          if (err) {\r\n            res.json({\r\n              isError: true,\r\n              data: err\r\n            })\r\n            \r\n          } \r\n          else \r\n          {\r\n            if (userElection.length>0) {\r\n              // console.log(\"userElection==>\",userElection);\r\n               var searchQuery = {\r\n              $and: [\r\n                { '_id':  mongoose.Types.ObjectId(decoded.id) },\r\n                { 'company_name': company_name },\r\n              ]\r\n            };\r\n            usersModel.find(searchQuery\r\n            ,function(err, result) {\r\n              if (err) {\r\n                res.json({\r\n                  isError: true,\r\n                  data: err\r\n                 })\r\n              } else {\r\n               \r\n                let supportArray=result[0].support;\r\n              \r\n\r\n                if (supportArray.length>0) {  \r\n                  console.log(\"All array length==>\",candidateData.length,resultObj.length,userElection.length);\r\n\r\n                  \r\n                  userElection.forEach(element => {\r\n                    candidateData.forEach(item=>{\r\n                     if (item.candidate==element._id) {\r\n                      data={\r\n                        _id:element._id,\r\n                        full_name:element.full_name,\r\n                        phone_no:element.phone_no,\r\n                        imageUrl:element.imageUrl,\r\n                        status:element.status,\r\n                        support:item.support,\r\n                        department_name:element.department_name,\r\n                        company_name:element.company_name,\r\n                        isSupport:false\r\n                      }\r\n\r\n                       resultObj.push(data)\r\n                      \r\n                     }\r\n                   })\r\n                 });\r\n                 console.log(\"resultObj with support array==>\",resultObj.length,userElection.length);\r\n                //  return res.json({\r\n                //   success:true,\r\n                //   data:resultObj\r\n                //  })\r\n\r\n                var count=0;\r\n\r\n               \r\n                 if (resultObj.length==userElection.length) {\r\n                  resultObj.forEach(element=>{\r\n                    supportArray.forEach(resultItem=>{\r\n                   \r\n                      if (resultItem.candidate==element._id) {\r\n                        \r\n                       element.isSupport=true\r\n                       console.log(\"Support true==>\",element);\r\n\r\n                      } \r\n                \r\n                  })\r\n                  count++;\r\n                  })\r\n                  console.log(\"count and resultObj.length\",resultObj.length,count);\r\n                  \r\n                  if (count==resultObj.length) {\r\n                      console.log(\"resultObj==>\",resultObj);\r\n                      res.json({\r\n                        success: true,\r\n                        data: {resultObj}\r\n                      })\r\n                    }\r\n\r\n  \r\n                }\r\n                }\r\n\r\n                else {\r\n                  userElection.forEach(element => {\r\n                    candidateData.forEach(item=>{\r\n                     if (item.candidate==element._id) {\r\n                        data={\r\n                         _id:element._id,\r\n                         full_name:element.full_name,\r\n                         phone_no:element.phone_no,\r\n                         imageUrl:element.imageUrl,\r\n                         status:element.status,\r\n                         support:item.support,\r\n                         department_name:element.department_name,\r\n                         company_name:element.company_name,\r\n                         isSupport:false\r\n                       }\r\n                       resultObj.push(data)\r\n                      //  console.log(\"resultObj withOut support array==>\",resultObj,resultObj.length,candidateData.length);\r\n                     }\r\n                   })\r\n                 });\r\n                 if (resultObj.length==candidateData.length) {\r\n                  //  console.log(\"resultObj==>\",resultObj);\r\n                   res.json({\r\n                     success: true,\r\n                     data: {resultObj}\r\n                   })\r\n                 }\r\n                }\r\n               \r\n              \r\n              }\r\n            })\r\n         \r\n              \r\n              \r\n            } else {\r\n              res.json({\r\n                isError: true,\r\n                data: 'candidate not found'\r\n              })\r\n              console.log(\"userElection==>\",userElection);\r\n            }\r\n           \r\n          }\r\n          \r\n        }).sort('department_name')\r\n        \r\n        \r\n      } else {\r\n        \r\n        res.json({\r\n          isError:true,\r\n          data:'No data found'\r\n        })\r\n      }\r\n    \r\n    \r\n    }\r\n    \r\n  })\r\n  \r\n  },\r\n  getAllApproveCandidateNew:(req,res,next)=>{\r\n    let company_name=req.body.company_name\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    var findElectionQuery={\r\n     $and:[\r\n       {company_name:company_name},\r\n       {isActive:true},\r\n     ]\r\n   }\r\n \r\n    electionDetailsModel.find(findElectionQuery,function (err,result) {\r\n     if (err) {\r\n       res.json({\r\n         isError: true,\r\n         data: err\r\n       })\r\n       \r\n     } else {\r\n       if (result.length>0) {\r\n         var election_name=result[0].election_name\r\n         console.log(\"Election name==>\",election_name);\r\n         var findQuery={\r\n           $and:[\r\n             {company_name:company_name},\r\n          \r\n             {election_name:election_name},\r\n             {isApprove:true}\r\n           ]\r\n         }\r\n           var resultObj=[]\r\n           var candidateData=[];\r\n           var data={}\r\n           candidateData=result[0].candidateData;    \r\n\r\n\r\n           userElectionModel.aggregate(\r\n            [\r\n              { $group : { _id : \"$department_name\", userElectionData: { $push: \"$$ROOT\" } }  }\r\n            ], function (err,userElection) {\r\n              if (err) {\r\n                res.json({\r\n                  isError: true,\r\n                  data: err\r\n                })\r\n                \r\n              } else \r\n              {\r\n               \r\n                if (userElection.length>0) {\r\n                  \r\n                  res.json({\r\n                    success: true,\r\n                    data: userElection\r\n                  })\r\n                } else {\r\n                  res.json({\r\n                    isError: true,\r\n                    data: 'No candidates Found'\r\n                  })\r\n                }\r\n              }\r\n              \r\n            }\r\n         )\r\n         \r\n       } else {\r\n         \r\n         res.json({\r\n           isError:true,\r\n           data:'No data found'\r\n         })\r\n       }\r\n     \r\n     \r\n     }\r\n     \r\n   })\r\n \r\n \r\n \r\n \r\n \r\n \r\n   \r\n   },\r\n  tryAggregration:(req,res,next)=>{\r\n    usersModel.find( { $nor: [ { company_name: { $exists: true }}, { company_name: 'Goodyear' } ]  },function (err,result) {\r\n      if (err) {\r\n        res.json({\r\n          isError:true,\r\n          data:err\r\n        })\r\n        \r\n      } else {\r\n        res.json({\r\n          success:true,\r\n          data:result\r\n        })\r\n      }\r\n      \r\n    })\r\n   \r\n  },\r\n  approveCandidateData:(req,res,next)=>{\r\n    let company_name=req.body.company_name\r\n   //  let department_name=req.body.department_name\r\n    console.log(\"approveCandidateData->\",req.body);\r\n    \r\n    var findElectionQuery={\r\n     $and:[\r\n       {company_name:company_name},\r\n       {isActive:true},\r\n     ]\r\n   }\r\n    electionDetailsModel.find(findElectionQuery,function (err,result) {\r\n     if (err) {\r\n       res.json({\r\n         isError: true,\r\n         data: err\r\n       })\r\n       \r\n     } else {\r\n       // console.log(\"electionDetailsModel->\",result);\r\n       if (result.length>0) {\r\n         var election_name=result[0].election_name\r\n \r\n         var findQuery={\r\n           $and:[\r\n             {company_name:company_name},\r\n             {election_name:election_name},\r\n             {isApprove:true}\r\n           ]\r\n         }\r\n           var resultObj=[]\r\n   \r\n           var candidateData=[];\r\n           var data={}\r\n           candidateData=result[0].candidateData;    \r\n          userElectionModel.find(findQuery,\r\n         function (err,userElection) {\r\n           if (err) {\r\n             res.json({\r\n               isError: true,\r\n               data: err\r\n             })\r\n             \r\n           } \r\n           else \r\n           {\r\n             if (userElection.length>0) {     \r\n                   userElection.forEach(element => {\r\n                     candidateData.forEach(item=>{\r\n                      if (item.candidate==element._id) {\r\n                         data={\r\n                          _id:element._id,\r\n                          full_name:element.full_name,\r\n                          phone_no:element.phone_no,\r\n                          imageUrl:element.imageUrl,\r\n                          status:element.status,\r\n                          support:item.support,\r\n                          department_name:element.department_name,\r\n                          company_name:element.company_name,\r\n                        \r\n                        }\r\n                        resultObj.push(data)\r\n                      }\r\n                    })\r\n                  });\r\n                  if (resultObj.length==candidateData.length) {\r\n                   //  console.log(\"resultObj==>\",resultObj);\r\n                    res.json({\r\n                      success: true,\r\n                      data: {resultObj}\r\n                    })\r\n                  }\r\n               \r\n             } else {\r\n               res.json({\r\n                 isError: true,\r\n                 data: 'candidate not found'\r\n               })\r\n               console.log(\"userElection==>\",userElection);\r\n             }\r\n            \r\n           }\r\n           \r\n         }).sort('department_name')\r\n         \r\n         \r\n       } else {\r\n         \r\n         res.json({\r\n           isError:true,\r\n           data:'No data found'\r\n         })\r\n       }\r\n     \r\n     \r\n     }\r\n     \r\n   })\r\n   \r\n   },\r\n  \r\n};\r\n\r\nmodule.exports= electionController;"]}
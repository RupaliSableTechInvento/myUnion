{"version":3,"sources":["../../server/controller/usersController.js"],"names":["usersModel","require","companyModel","messagesModel","userElectionModel","electionDetailsModel","mail_responseModel","jwt","env","nodemailer","mongoose","encode","hashCode","generator","axios","base64ToImage","path","search","election_name","candidate","supportArray","i","length","async","addSupport","ajax_data","mainCallback","results","phone_no","_isValidCandidate","callback","console","log","find","_id","Types","ObjectId","err","userElection","_getDeptVoteCount","company_name","department_name","department","getDept","Object","keys","forEach","key","_validateVoting","findOne","user","deptData","deptDataOfVoting","assignDeptCount","voteCount","count","canVote","canvote","waterfall","demo","searchData","searchQuery","a","_checkSupportCount","b","_getAllMeeting","c","usersController","getAllMessagesWithFriend","req","res","next","decoded","verify","body","authorization","App_key","friend","query","data","date","temp","limit","$or","$and","sender","email","reciever","$lt","sort","exec","messages","json","isError","success","setMsgRead","arrMsgID","arrMsgIDList","map","aField","bulk","collection","initializeUnorderedBulkOp","item","index","updateOne","$set","isRead","execute","getFriendsList","users","getUserInfo","url","addUserProfilePic","imgURL","findOneAndUpdate","getAllCount","getAll","addUserInfo","new","userProfile","id","tokenModel","tokenData","getOne","create","addImage","base64Str","imageUrl","imageUrls","folderPath","join","__dirname","optionalObj","imageInfo","push","fileName","delete","isActive","ok","forgotPassword","result","passwordGenerated","generate","numbers","userMsg","new_pasword","value","get","trim","then","response","update","nModified","catch","error","isVerified","token","emailVerification","host","headers","d","Date","v","setMinutes","getMinutes","sign","exp","Math","floor","createTestAccount","account","transporter","createTransport","service","auth","pass","htmlforemail","mailOptions","from","to","subject","text","html","sendMail","info","messageId","getTestMessageUrl","emailVerified","params","dt","checkDate","redirect","varifyToken","changePassword","password","addCandidate","save","send","support","isAlreadyVote","dataObj","q1","queryString","$not","$elemMatch","$inc","$push","options","upsert","electionDetails","candidateData","unSupport","$unset","module","exports"],"mappings":"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","file":"usersController.js","sourcesContent":["var usersModel =require( '../models/usersModel')\r\n// var tokenModel =require( './../models/tokenModel');\r\nvar companyModel =require( '../models/companyModel')\r\n\r\nvar messagesModel =require( '../models/messagesModel');\r\nvar userElectionModel =require('../models/userElectionModel')\r\nvar electionDetailsModel=require('../models/electionDetailsModel');\r\nvar mail_responseModel =require( '../models/mail_responseModel')\r\n// var postatrade =require( '../models/postatrade')\r\nvar jwt =require( 'jsonwebtoken');\r\nvar env =require( \"../env\");\r\nconst nodemailer = require('nodemailer');\r\nvar mongoose = require('mongoose');\r\nvar encode = require('hashcode').hashCode;\r\nvar encode = require('hashcode').hashCode;\r\nvar generator = require('generate-password');\r\nconst axios = require('axios');\r\nvar base64ToImage = require('base64-to-image');\r\nconst path = require('path')\r\nfunction search(election_name,candidate, supportArray){\r\n  for (var i=0; i < supportArray.length; i++) {\r\n      if ((supportArray[i].election_name === election_name)&&(supportArray[i].candidate === candidate)) {\r\n          return true;\r\n      }\r\n      if (i>supportArray.length) {\r\n\r\n         return false;\r\n      }\r\n      \r\n  }\r\n}\r\n\r\n\r\nconst async = require('async');\r\n\r\n\r\nfunction addSupport(ajax_data, mainCallback) {\r\n\r\n  var results = {};\r\n  var candidate=ajax_data.candidate;\r\n    var  phone_no=ajax_data.phone_no\r\n\r\n  function _isValidCandidate(callback) {\r\n    console.log(\"_isValidCandidate\");\r\n    \r\n     userElectionModel.find({ _id: mongoose.Types.ObjectId(candidate)},function (err,userElection) {\r\n       if (err) {\r\n         callback(err)\r\n       } else {\r\n         results.userElection=userElection\r\n         console.log(\"Result==>\",results);\r\n         \r\n         callback(null,results)\r\n       }\r\n     })\r\n\r\n  }\r\n\r\n  function _getDeptVoteCount(results, callback) {\r\n    var company_name=results.userElection[0].company_name;\r\n    var department_name=results.userElection[0].department_name;\r\n    console.log(\"company name and department==>\",company_name,department_name);\r\n    \r\n    companyModel.find(\r\n        {company_name:company_name},{department:1,_id:0},function(err, department) {\r\n      if (err) {\r\n        callback(err)\r\n      } else {\r\n        console.log(\"_getDeptVoteCount==>\",department);\r\n        var getDept=department[0].department;\r\n        console.log(\"Department==>\",getDept);\r\n        Object.keys(getDept).forEach(function(key) {\r\n          if (key==department_name) {\r\n            results.department = getDept[key];\r\n          }\r\n      });\r\n        callback(null, results)\r\n      }\r\n    })\r\n  }\r\n\r\n  function _validateVoting(results, callback) {\r\n    console.log(\"_validateVoting\",results,phone_no);\r\n    usersModel.findOne({phone_no:phone_no},function (err,user) {\r\n      if (err) {\r\n        callback(err)\r\n      } else {\r\n        \r\n        \r\n        var deptData=user.deptDataOfVoting;\r\n        console.log(\"_validateVoting data==>\",deptData);\r\n\r\n        var department_name=results.userElection[0].department_name;\r\n        var assignDeptCount=results.department.voteCount;\r\n\r\n        Object.keys(deptData).forEach(function(key) {\r\n          if (key==department_name) {\r\n            console.log(\"key matched\", deptData[key].count, key,department_name);\r\n            \r\n            if (deptData[key].count>=assignDeptCount) {\r\n              console.log(\"Voting Limit reached\",key,department_name);\r\n\r\n              results.canVote=false;\r\n              callback(null, results)\r\n              \r\n            } else {\r\n              results.canvote=true;\r\n              callback(null, results)\r\n              \r\n            }\r\n            \r\n          }\r\n      });\r\n\r\n\r\n\r\n\r\n        // callback(null,results)\r\n      }\r\n    })\r\n    \r\n   \r\n    \r\n  }\r\n\r\n  async.waterfall([\r\n    _isValidCandidate, _getDeptVoteCount, _validateVoting\r\n  ], function(err, results) {\r\n    if (err) {\r\n      console.log(\"maincallback Err=>\",err);\r\n      \r\n      mainCallback(err)\r\n    } else {\r\n      console.log(\"maincallback Results=>\",results);\r\n\r\n      mainCallback(null, results)\r\n    }\r\n  })\r\n}\r\n\r\n\r\n\r\nfunction demo(ajax_data, mainCallback) {\r\n  var searchData = 'search';\r\n  var searchQuery;\r\n  // searchData = Number(searchData);\r\n  // if (Number.isNaN(searchData)) {\r\n  //   searchData = '';\r\n  // }\r\n  if (searchData != '') {\r\n    console.log(\"SearchData for meeting\", searchData);\r\n    // var regexString = new RegExp('.*' + searchData + '.*', 'i');\r\n    // searchQuery = { meeting_no: { $regex: regexString } };\r\n\r\n  } else {\r\n    searchQuery = {};\r\n  }\r\n  // var meeting = Database.getCollection('meeting');\r\n  var results = {};\r\n\r\n  function _isValidCandidate(callback) {\r\n    console.log(\"_isValidCandidate\");\r\n    \r\n\r\n    var a=1;\r\n    if (!a) {\r\n      callback(err)\r\n    } else {\r\n      results.a = a\r\n      callback(null, results)\r\n      \r\n    }\r\n\r\n  }\r\n\r\n  function _checkSupportCount(results, callback) {\r\n    console.log(\"_checkSupportCount\",results);\r\n    \r\n \r\n    var b=1;\r\n    if (!b) {\r\n      callback(err)\r\n    } else {\r\n      results.b = b\r\n      callback(null, results)\r\n      \r\n    }\r\n  }\r\n\r\n  function _getAllMeeting(results, callback) {\r\n    console.log(\"_getAllMeeting\",results);\r\n    \r\n    var c=1;\r\n    if (!c) {\r\n      callback(err)\r\n    } else {\r\n      results.c = c\r\n      callback(null, results)\r\n      \r\n    }\r\n  }\r\n\r\n  async.waterfall([\r\n    _isValidCandidate, _checkSupportCount, _getAllMeeting\r\n  ], function(err, results) {\r\n    if (err) {\r\n      console.log(\"maincallback Err=>\",err);\r\n      \r\n      mainCallback(err)\r\n    } else {\r\n      console.log(\"maincallback Results=>\",results);\r\n\r\n      mainCallback(null, results)\r\n    }\r\n  })\r\n}\r\n\r\n\r\n\r\nconst usersController = {\r\n \r\n\r\n  getAllMessagesWithFriend: (req, res, next) => {\r\n\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    // console.log(\"getAllMessagesWithFriend reqest from==>\", decoded.email, req.query.data)\r\n    var friend = req.query.data.friend;\r\n    var date = req.query.data.date;\r\n    var temp = req.query.data.limit;\r\n    var limit = '';\r\n    // var limit=parseInt(temp)\r\n    // if (temp && temp < 10) {\r\n    //   limit = temp\r\n    // } else {\r\n    //   limit = 10;\r\n    // }\r\n    var query = '';\r\n    if (date) {\r\n      query = {\r\n        $or: [\r\n          { $and: [{ sender: decoded.email }, { reciever: friend }] },\r\n          { $and: [{ sender: friend }, { reciever: decoded.email }] }\r\n        ],\r\n        \"date\": { $lt: date }\r\n      }\r\n    } else {\r\n      query = {\r\n        $or: [\r\n          { $and: [{ sender: decoded.email }, { reciever: friend }] },\r\n          { $and: [{ sender: friend }, { reciever: decoded.email }] }\r\n        ]\r\n      }\r\n    }\r\n\r\n\r\n\r\n    messagesModel.find(\r\n      query\r\n    ).sort({ 'date': -1 }).limit(10)\r\n\r\n\r\n    .exec(function(err, messages) {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: messages\r\n      });\r\n    });\r\n\r\n  \r\n\r\n  },\r\n  setMsgRead: (req, res, next) => {\r\n    var arrMsgID = [];\r\n    arrMsgID = req.body.data;\r\n    console.log(\"arrMsgID\", arrMsgID);\r\n    var _id = '';\r\n    var arrMsgIDList = arrMsgID.map(function(aField) {\r\n        // return mongoose.Types.ObjectId(aField);\r\n        return aField\r\n      })\r\n    \r\n\r\n    var bulk = messagesModel.collection.initializeUnorderedBulkOp();\r\n\r\n    arrMsgID.forEach((item, index) => {\r\n      _id = mongoose.Types.ObjectId(item)\r\n        // var id = arrMsgID[index];\r\n      bulk.find({ _id: _id }).updateOne({ $set: { isRead: true } });\r\n\r\n    })\r\n    bulk.execute((err, messages) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: messages\r\n      });\r\n    });\r\n\r\n  },\r\n  getFriendsList: (req, res, next) => {\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    console.log(\"addUserInfo\", decoded.email)\r\n    usersModel.find({\r\n      'email': decoded.email\r\n    }, { \"friends\": 1, \"_id\": 0 }, (err, users) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: users\r\n      });\r\n    });\r\n  },\r\n  getUserInfo: (req, res, next) => {\r\n    console.log(\"get USer Info call from frnt end\",req.url,req.body);\r\n    \r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    usersModel.find({\r\n      phone_no:decoded.phone_no\r\n    }, (err, users) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: users\r\n      });\r\n    });\r\n  },\r\n  addUserProfilePic: (req, res, next) => {\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n\r\n    var imgURL = req.body.imgURL;\r\n\r\n    usersModel.findOneAndUpdate({\r\n      'email': decoded.email\r\n    }, {\r\n      $set: {\r\n        imgURL: imgURL\r\n      }\r\n    }, (err, data) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      else {\r\n        res.json({\r\n          success: true,\r\n          data: data\r\n        })\r\n      }\r\n    });\r\n  },\r\n\r\n  getAllCount:(req,res,next)=>{\r\n    console.log(\"getAllUserCount==>\");\r\n    \r\n    var company_name=req.body.company_name;\r\n    var query={};\r\n    if (company_name) {\r\n      query={\r\n        'company_name':company_name\r\n      }\r\n      \r\n    }\r\n    else{\r\n      query={\r\n\r\n      }\r\n    }\r\n    usersModel.count(query,function (err,user) {\r\n        if (err) {\r\n            res.json({\r\n                isError:true,\r\n                data:err\r\n            })            \r\n        }\r\n        else{\r\n          console.log(\"company found==>\",user);\r\n          res.json({\r\n              success:true,\r\n              data:user\r\n          })\r\n        }\r\n        \r\n    })\r\n  },\r\n\r\n  getAll: async(req, res, next) => {\r\n    usersModel.find({}, (err, users) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: users\r\n      });\r\n    });\r\n\r\n  },\r\n  addUserInfo: async(req, res, next) => {\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    usersModel.findOneAndUpdate({\r\n\r\n      'email': decoded.email\r\n    }, req.body, {\r\n      new: true\r\n    }, (err, user) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: user\r\n      })\r\n    });\r\n\r\n  },\r\n  userProfile: (req, res, next) => {\r\n    // var _id = Number(req.query.id);\r\n\r\n    var _id = mongoose.Types.ObjectId(req.query.id);\r\n    console.log(\"id=>\", _id);\r\n    usersModel.findOne({\r\n      _id: _id\r\n    }, (err, user) => {\r\n\r\n      if (err) {\r\n        res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n      } else {\r\n        var email = user.email;\r\n        console.log(\"Email==>\", email);\r\n        tokenModel.findOne({ 'email': email }, (err, tokenData) => {\r\n          res.json({\r\n            success: true,\r\n            data: { user: user, tokenData: tokenData }\r\n          });\r\n        }).sort({ _id: -1 }).limit(1)\r\n\r\n      }\r\n    });\r\n  },\r\n  getOne: (req, res, next) => {\r\n    // console.log(\"------------\",next);\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    usersModel.findOne({\r\n      'phone_no': decoded.phone_no\r\n    }, (err, user) => {\r\n      if (err) {\r\n        res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n      } else {\r\n        res.json({\r\n          success: true,\r\n          data: user\r\n        });\r\n      }\r\n    });\r\n  },\r\n\r\n  create: (req, res, next) => {\r\n    usersModel.create(req.body, function(err, user) {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: user\r\n      })\r\n    })\r\n  },\r\n\r\n  addImage: (req, res, next) => {\r\n    // var id = mongoose.Types.ObjectId(req.body.id);\r\n      var base64Str = req.body.imageUrl;\r\n      var imageUrls = [];\r\n      var folderPath = path.join(__dirname+'../../../', 'frontend', 'Images', '_');\r\n      console.log(\"Folder path==>\",folderPath);\r\n      var optionalObj = { 'fileName': 'rupali', 'type': 'png' };\r\n      var imageInfo = base64ToImage(base64Str, folderPath, optionalObj);\r\n      imageUrls.push({ url: '/Images/_' + imageInfo.fileName, })\r\n      var query={\r\n        $set:{\r\n          imgURL : imageUrls,\r\n        }\r\n        \r\n      }\r\n    usersModel.findOneAndUpdate({\r\n      'phone_no': '7276374306'\r\n    }, query, {\r\n      new: true\r\n    }, (err, user) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: user\r\n      })\r\n    });\r\n  },\r\n\r\n  delete: (req, res, next) => {\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    usersModel.findOneAndUpdate({\r\n      'email': decoded.email\r\n    }, {\r\n      isActive: 'inactive'\r\n    }, (err, ok) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      else {\r\n        res.json({\r\n          success: true,\r\n          data: true\r\n        })\r\n      }\r\n    });\r\n  },\r\n \r\n  forgotPassword: (req, res, next) => {\r\n    var phone_no = req.body.phone_no;\r\n    console.log(\"forgot password password request==>\",phone_no);\r\n\r\n    usersModel.find({\r\n      'phone_no': req.body.phone_no\r\n    }, function(err, result) {\r\n      if (err) {\r\n        res.json({ \r\n          isError: true,\r\n          data: err\r\n        })\r\n      } else {\r\n        if (result != \"\") {\r\n          var passwordGenerated = generator.generate({\r\n            length: 6,\r\n            numbers: true\r\n          });\r\n          var userMsg='Congrats you are new passord. :'+passwordGenerated+' '+'Please login with new password.';\r\n          var new_pasword = encode().value(passwordGenerated);\r\n\r\n        \r\n          axios.get('http://sms.swebsolutions.in/api/mt/SendSMS?user=WEBSOLUTION&password=swsmymv*13&senderid=SWSCOM&channel=Trans&DCS=0&flashsms=0&number='+ phone_no.trim() +'&text= '+ userMsg+'&route=6')\r\n          .then(response => {\r\n\r\n\r\n            usersModel.update({\r\n              $and: [{ phone_no: phone_no  }]\r\n        \r\n            }, { $set: { \"password\":new_pasword } }, function(err, result) {\r\n              if (result.nModified) {\r\n\r\n                console.log(\"pasword modified-->\",result);\r\n                \r\n        \r\n                res.json({\r\n                  success: true,\r\n                  data: 'New password has been sent to your registerd No.'\r\n                });\r\n    \r\n\r\n              }\r\n            })\r\n           \r\n          \r\n\r\n          })\r\n          .catch(error => {\r\n            console.log(error);\r\n          });\r\n\r\n\r\n        } else {\r\n          console.log(\"result==> phone no not found\",result);\r\n          \r\n          res.json({\r\n            isError: true,\r\n            data: 'sorry Not a registerd number'\r\n          });\r\n        }\r\n      }\r\n    })\r\n  },\r\n  isVerified: (req, res, next) => {\r\n    var decoded = jwt.verify(req.query.token, env.App_key);\r\n    usersModel.findOneAndUpdate({\r\n      'email': decoded.email\r\n    }, (err, user) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      res.json({\r\n        success: true,\r\n        data: user\r\n      });\r\n    });\r\n\r\n  },\r\n  emailVerification: (req, res, next) => {\r\n    var host = req.headers.host;\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    console.log(\"Emailverification==>\", decoded.email);\r\n    usersModel.find({\r\n      'email': decoded.email\r\n    }, function(err, result) {\r\n      if (err) {\r\n        res.json({\r\n          isError: true,\r\n          data: err\r\n        })\r\n      } else {\r\n        if (result != \"\") {\r\n          var d = new Date();\r\n          var v = new Date();\r\n          v.setMinutes(d.getMinutes() + 30);\r\n          const token = jwt.sign({\r\n            exp: Math.floor(v),\r\n            email: decoded.email,\r\n          }, env.App_key);\r\n          console.log(result);\r\n          nodemailer.createTestAccount((err, account) => {\r\n            // create reusable transporter object using the default SMTP transport\r\n            var transporter = nodemailer.createTransport({\r\n              service: 'gmail',\r\n              auth: {\r\n                user: 'itstechinvento@gmail.com',\r\n                pass: 'techinvento123'\r\n              }\r\n            });\r\n            var htmlforemail = ``;\r\n            let mailOptions = {\r\n              from: 'itstechinvento@gmail.com', // sender address\r\n              to: decoded.email, // list of receivers\r\n              subject: 'Email Verification', // Subject line\r\n              text: 'Please Click below link to Verify Your Email address', // plain text body\r\n              html: 'Please<a id =\"varified\"href=http://' + host + '/ev/' + token + '>Click Here to processed email verification</a>',\r\n            };\r\n            transporter.sendMail(mailOptions, (error, info) => {\r\n             \r\n              if (error) {\r\n                res.json({\r\n                  isError: true,\r\n                  data: error\r\n                });\r\n                return console.log(\"error--11--\", error);\r\n              } else {\r\n                console.log('Message sent: %s', info.messageId);\r\n                console.log('Preview URL: %s', nodemailer.getTestMessageUrl(info));\r\n                res.json({\r\n                  success: true,\r\n                  data: 'Please check your email'\r\n                });\r\n              }\r\n            });\r\n          });\r\n        } else {\r\n          res.json({\r\n            isError: true,\r\n            data: 'please provide a valid mail'\r\n          });\r\n        }\r\n      }\r\n    })\r\n  },\r\n  emailVerified: (req, res, next) => {\r\n    var decoded = jwt.verify(req.params.token, env.App_key);\r\n    var dt = new Date();\r\n    var checkDate = new Date(decoded.exp);\r\n    if (dt < checkDate) {\r\n      console.log(\"----------\");\r\n      usersModel.findOneAndUpdate({\r\n        \"email\": decoded.email\r\n      }, {\r\n        $set: {\r\n          \"verification.email_verified\": true\r\n        }\r\n      }, (err, user) => {\r\n        if (err) return res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n        res.redirect('/#/profile');\r\n        // res.send('verified')\r\n        //res.json({ isError: false, data: \"your E-Mail address is verified sucessfully\" });\r\n\r\n      });\r\n    } else {\r\n      res.json({\r\n        isError: true,\r\n        data: \"session expire\"\r\n      });\r\n    }\r\n  },\r\n  varifyToken: (req, res, next) => {\r\n    console.log(\"in verify Token=>\");\r\n    var decoded = jwt.verify(req.params.token, env.App_key);\r\n    var dt = new Date();\r\n    var checkDate = new Date(decoded.exp);\r\n    if (dt < checkDate) {\r\n      console.log(\"----\");\r\n      var d = new Date();\r\n      var v = new Date();\r\n      v.setMinutes(d.getMinutes() + 60);\r\n      const token = jwt.sign({\r\n        exp: Math.floor(v),\r\n        email: decoded.email,\r\n      }, env.App_key);\r\n      res.redirect('/recover/' + token)\r\n    } else {\r\n      res.json({\r\n        isError: true,\r\n        data: \"session expire\"\r\n      });\r\n    }\r\n  },\r\n  changePassword: (req, res, next) => {\r\n    // console.log(\"req.headers--->\", req.body.authorization, req.body);\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    console.log(\"change password request==>\",decoded.phone_no);\r\n    \r\n    req.body.password = encode().value(req.body.password);\r\n    req.body.new_pasword = encode().value(req.body.new_pasword);\r\n    usersModel.findOneAndUpdate({\r\n      $and: [{\r\n        \"password\": req.body.password\r\n      }, {\r\n        \"phone_no\": decoded.phone_no\r\n      }]\r\n    }, {\r\n      $set: {\r\n        \"password\": req.body.new_pasword,\r\n      }\r\n    }, (err, user) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n      if(user){\r\n          res.json({\r\n            success: true,\r\n            data: \"Password has been Changed successfully\"\r\n          });\r\n          \r\n    \r\n      }\r\n      else{\r\n        res.json({\r\n          isError: true,\r\n          data: 'No Record Found'\r\n        });\r\n \r\n      }\r\n  \r\n    \r\n      console.log(\"user=>\", user);\r\n    })\r\n  },\r\n  addCandidate:(req,res,next)=>{\r\n    console.log(\"addCandidate==>\",req.body);\r\n    let userElection = new userElectionModel(req.body);\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n\r\n    var phone_no=decoded.phone_no;\r\n\r\n    usersModel.find(\r\n    {\r\n      $and: [{\r\n        phone_no:phone_no\r\n      }, {\r\n        company_name: req.body.company_name\r\n      },\r\n      {\r\n        department_name: req.body.department_name\r\n      }\r\n    ]\r\n    },function (err,user) {\r\n      if (err) {\r\n        res.json({\r\n          isError:true,\r\n          data:err\r\n        });\r\n      \r\n      } else if(user.length){\r\n        userElection.save(req.body, function(err, user) {\r\n          if (err) {\r\n            res.json({\r\n              isError:true,\r\n              data:err\r\n            });\r\n\r\n          }\r\n          else{\r\n            res.json({\r\n              success:true,\r\n              data:user\r\n            });\r\n          }\r\n        })\r\n        \r\n      }\r\n      else{\r\n        console.log(\"USer Not Found==>\",user);\r\n        \r\n        res.json({\r\n          isError:true,\r\n          data:err\r\n        });\r\n\r\n      }\r\n      \r\n    })\r\n  },\r\n  addSupport:(req,res,next)=>{\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    console.log(\"add support request==>\",decoded.phone_no);\r\n  var election_name=req.body.election_name\r\n    var candidate=req.body.candidate\r\n  \r\n    // candidate is candidate _id from userElection\r\n    var ajax_data = {\r\n      election_name:req.body.election_name,\r\n      candidate:req.body.candidate,\r\n      phone_no:decoded.phone_no\r\n\r\n    }\r\n    userElectionModel.find({ _id: mongoose.Types.ObjectId(candidate)},function (err,userElection) {\r\n      if (err) {\r\n        res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n      } else {\r\n\r\n        if (userElection.length>0) {\r\n          \r\n    addSupport(ajax_data, function(err, data) {\r\n      if (err) {\r\n        res.send({ success: false, data: err });\r\n      } else {\r\n        console.log(\"Addsupport ==>>\",data);\r\n        if (data.canVote==false) {\r\n          res.send({ success: false, data: 'Limit Reached' });\r\n          \r\n        } else {\r\n          console.log(\"Valid Voting==>\",data.canvote);\r\n          \r\n        usersModel.find({ phone_no:decoded.phone_no},function (err,result) {\r\n          if(err){\r\n            res.json({\r\n              isError: true,\r\n              data: err\r\n            });\r\n          }\r\n          else{\r\n            var company_name=data.userElection[0].company_name;\r\n            var department_name=data.userElection[0].department_name\r\n            var supportArray=result[0].support\r\n            var isAlreadyVote=search(election_name,candidate, supportArray)\r\n\r\n            if (isAlreadyVote) {\r\n              res.json({\r\n                isError:true,\r\n                data:'Invalid Attempt'\r\n              })\r\n              \r\n            } else {\r\n              \r\n            var dataObj={\r\n              election_name:req.body.election_name,\r\n              candidate:req.body.candidate,\r\n              company_name:company_name,\r\n              department_name:department_name,\r\n              date:new Date()\r\n            }\r\n            var q1='deptDataOfVoting.'+department_name\r\n          var queryString=q1+'.count';\r\n          \r\n            query = { $and:[\r\n              { phone_no:decoded.phone_no},\r\n              {\"support\":{ $not: {$elemMatch: { candidate} } }}\r\n            ]},\r\n            update = {\r\n              $inc: { [queryString]: 1 } ,\r\n              $push: { support: dataObj } \r\n            },\r\n            options = {upsert: true};\r\n            \r\n          usersModel.findOneAndUpdate(\r\n          query,update,options\r\n        ,function (err,user) {\r\n          if (err) {\r\n            res.json({\r\n              isError: true,\r\n              data: err\r\n            });\r\n            \r\n          } else {\r\n            console.log(\"add support  result==>\",user);\r\n\r\n            electionDetailsModel.find({ election_name:req.body.election_name},\r\n              \r\n              function (err,electionDetails) {\r\n              if (err) {\r\n                res.json({\r\n                  isError: true,\r\n                  data: err\r\n                });\r\n                \r\n              } else {\r\n\r\n                console.log(\"Election Details==>\",electionDetails);\r\n              \r\n                var candidateData= electionDetails[0].candidateData;\r\n                candidateData.forEach((item, index) => {\r\n                  if (item.candidate == req.body.candidate) {\r\n                    electionDetailsModel.findOneAndUpdate(\r\n                  {\r\n                    $and:[\r\n                      { election_name:req.body.election_name},\r\n                      {[`candidateData.${index}.candidate`]: req.body.candidate}\r\n                    ]\r\n                  }, { $inc: { [`candidateData.${index}.support`]: 1 } },{new:true},function (err,result) {\r\n                    if (err) {\r\n                      res.json({\r\n                        isError: true,\r\n                        data: err\r\n                      });\r\n                    }\r\n                    else{\r\n                      console.log(\" support added result==>\",result);\r\n          \r\n                      res.json({\r\n                        success: true,\r\n                        data: result\r\n                      });\r\n                    }\r\n                    \r\n                  })\r\n\r\n                  }\r\n                \r\n              })\r\n            }\r\n              \r\n            })\r\n\r\n          \r\n          }\r\n          \r\n        })\r\n\r\n          }\r\n          \r\n          }\r\n          \r\n        })\r\n        }\r\n      \r\n      }\r\n    })\r\n        }\r\n        else{\r\n          res.json({\r\n            isError: true,\r\n            data: 'Invalid Attempt'\r\n          });\r\n        }\r\n      }\r\n    })\r\n  },\r\n  unSupport:(req,res,next)=>{\r\n\r\n    var decoded = jwt.verify(req.body.authorization, env.App_key);\r\n    console.log(\"unSupport  request==>\",decoded.phone_no);\r\n  var election_name=req.body.election_name\r\n    var candidate=req.body.candidate\r\n  \r\n    var ajax_data = {\r\n      election_name:req.body.election_name,\r\n      candidate:req.body.candidate,\r\n      phone_no:decoded.phone_no\r\n\r\n    }\r\n    userElectionModel.find({ _id: mongoose.Types.ObjectId(candidate)},function (err,userElection) {\r\n      if (err) {\r\n        res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n      } else {\r\n\r\n        if (userElection.length>0) {\r\n          usersModel.find({ phone_no:decoded.phone_no},function (err,result) {\r\n            if(err){\r\n              res.json({\r\n                isError: true,\r\n                data: err\r\n              });\r\n            }\r\n            else{\r\n          \r\n              var department_name=userElection[0].department_name\r\n              var supportArray=result[0].support\r\n              var isAlreadyVote=search(election_name,candidate, supportArray)\r\n\r\n              if (!isAlreadyVote) {\r\n                res.json({\r\n                  isError:true,\r\n                  data:'Invalid Attempt'\r\n                })\r\n                \r\n              } else {\r\n            \r\n              var q1='deptDataOfVoting.'+department_name\r\n              var queryString=q1+'.count';\r\n            \r\n              query = { $and:[\r\n                { phone_no:decoded.phone_no},\r\n                {\"support\": {$elemMatch: { candidate} } }\r\n              ]},\r\n              update = {\r\n                $inc: { [queryString]: -1 } ,\r\n                $unset : { support :{$elemMatch: {candidate : 1}}},\r\n              },\r\n              // $pullAll: { support :{$elemMatch: {candidate: null } }}\r\n\r\n              options = {upsert: true};\r\n              \r\n            usersModel.findOneAndUpdate(\r\n            query,update,options\r\n          ,function (err,user) {\r\n            if (err) {\r\n              res.json({\r\n                isError: true,\r\n                data: err\r\n              });\r\n              \r\n            } else {\r\n              console.log(\"Un support  result==>\",user);\r\n\r\n              electionDetailsModel.find({ election_name:req.body.election_name},\r\n                \r\n                function (err,electionDetails) {\r\n                if (err) {\r\n                  res.json({\r\n                    isError: true,\r\n                    data: err\r\n                  });\r\n                  \r\n                } else {\r\n\r\n                  console.log(\"Election Details==>\",electionDetails);\r\n                \r\n                  var candidateData= electionDetails[0].candidateData;\r\n                  candidateData.forEach((item, index) => {\r\n                    if (item.candidate == req.body.candidate) {\r\n                      electionDetailsModel.findOneAndUpdate(\r\n                    {\r\n                      $and:[\r\n                        { election_name:req.body.election_name},\r\n                        {[`candidateData.${index}.candidate`]: req.body.candidate}\r\n                      ]\r\n                    }, { $inc: { [`candidateData.${index}.support`]: -1 } },{new:true},function (err,result) {\r\n                      if (err) {\r\n                        res.json({\r\n                          isError: true,\r\n                          data: err\r\n                        });\r\n                      }\r\n                      else{\r\n                        console.log(\" Unsupport result==>\",result);\r\n            \r\n                        res.json({\r\n                          success: true,\r\n                          data: result\r\n                        });\r\n                      }\r\n                      \r\n                    })\r\n\r\n                    }\r\n                  \r\n                })\r\n              }\r\n                \r\n              })\r\n\r\n            \r\n            }\r\n            \r\n          })\r\n\r\n            }\r\n            \r\n            }\r\n            \r\n          })\r\n        \r\n        }\r\n        else{\r\n          res.json({\r\n            isError: true,\r\n            data: 'Invalid Attempt'\r\n          });\r\n        }\r\n      }\r\n    })\r\n\r\n\r\n  }\r\n};\r\n\r\nmodule.exports= usersController;"]}
{"version":3,"sources":["../../server/middlewares/authenticated.js"],"names":["jwt","require","env","tokenModel","authenticated","req","res","next","token","headers","today","Date","findOne","$and","expiry","$gt","err","user","json","isError","data","verify","App_key","decode","module","exports"],"mappings":"AAAA,IAAIA,MAAKC,QAAS,cAAT,CAAT;AACA,IAAIC,MAAKD,QAAS,QAAT,CAAT;AACA,IAAIE,aAAYF,QAAS,wBAAT,CAAhB;AACA,MAAMG,gBAAgB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACxC;AACA,QAAMC,QAAQH,IAAII,OAAJ,CAAY,eAAZ,CAAd;AACA,MAAIC,QAAQ,IAAIC,IAAJ,EAAZ;AACAR,aAAWS,OAAX,CAAmB;AACjBC,UAAM,CAAC;AACL,eAASL;AADJ,KAAD,EAEH;AACD,kBAAY;AADX,KAFG,EAIH;AACDM,cAAQ;AACNC,aAAKL;AADC;AADP,KAJG;AADW,GAAnB,EAUG,CAACM,GAAD,EAAMC,IAAN,KAAe;AAChB,QAAID,GAAJ,EAAS;AACPV,UAAIY,IAAJ,CAAS;AACPC,iBAAS,IADF;AAEPC,cAAMJ;AAFC,OAAT;AAID,KALD,MAKO;AACL,UAAIC,QAAQ,IAAZ,EAAkB;AAChB;AACAjB,YAAIqB,MAAJ,CAAWb,KAAX,EAAkBN,IAAIoB,OAAtB,EAA+B,CAACN,GAAD,EAAMO,MAAN,KAAiB;AAC9C,cAAIP,GAAJ,EAAS;AACPV,gBAAIY,IAAJ,CAAS;AACPC,uBAAS,IADF;AAEPC,oBAAMJ;AAFC,aAAT;AAID,WALD,MAKO;AACLT;AACD;AACF,SATD;AAUD,OAZD,MAYO;AACLD,YAAIY,IAAJ,CAAS;AACPC,mBAAS,IADF;AAEPC,gBAAM;AAFC,SAAT;AAID;AACF;AACF,GApCD;AAsCD,CA1CD;;AA4CAI,OAAOC,OAAP,GAAgBrB,aAAhB","file":"authenticated.js","sourcesContent":["var jwt =require( 'jsonwebtoken');\nvar env =require( \"../env\");\nvar tokenModel =require( './../models/tokenModel');\nconst authenticated = (req, res, next) => {\n  // console.log(\"req.headers\", req.headers)\n  const token = req.headers['authorization'];\n  var today = new Date();\n  tokenModel.findOne({\n    $and: [{\n      'token': token\n    }, {\n      'isActive': 'active'\n    }, {\n      expiry: {\n        $gt: today\n      }\n    }]\n  }, (err, user) => {\n    if (err) {\n      res.json({\n        isError: true,\n        data: err\n      });\n    } else {\n      if (user != null) {\n        // console.log(\"-------------\",user);\n        jwt.verify(token, env.App_key, (err, decode) => {\n          if (err) {\n            res.json({\n              isError: true,\n              data: err\n            })\n          } else {\n            next()\n          }\n        });\n      } else {\n        res.json({\n          isError: true,\n          data: \"Middle Order Login Again\"\n        })\n      }\n    }\n  });\n\n};\n\nmodule.exports= authenticated;"]}